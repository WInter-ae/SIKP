# Update: Simplified Revision Workflow - Single Document (Laporan KP PDF Only)

## ğŸ“‹ Overview

Workflow revisi telah disederhanakan fokus hanya pada **Laporan KP (PDF)**. Dosen sekarang memiliki pilihan yang lebih jelas di awal: apakah dokumen perlu revisi atau tidak.

## ğŸ¯ Perubahan Utama

### Sebelumnya (v1.0)
- Multiple documents (Laporan KP + Slide Presentasi)
- Toggle "Tidak Ada Revisi Diperlukan"
- Tab system: Menunggu / Disetujui / Ditolak
- Approve/Reject per dokumen

### Sekarang (v2.0) â­
- **Single document**: Hanya Laporan KP (PDF)
- **Decision-based workflow**: Pilih di awal "Perlu Revisi" atau "Tidak Perlu Revisi"
- **Direct messaging**: Dosen bisa kirim pesan revisi langsung
- **History tracking**: Lihat riwayat revisi sebelumnya
- **Simpler UI**: Lebih fokus dan tidak membingungkan

## ğŸ”„ New Workflow

### Stage 1: Undecided (Pilih Keputusan)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“„ Laporan KP Mahasiswa                â”‚
â”‚  - File: Laporan_KP_RizkiMaulana.pdf   â”‚
â”‚  - Size: 2.5 MB                        â”‚
â”‚  - Version: 3                          â”‚
â”‚  - Uploaded: 10 Jan 2026 14:30        â”‚
â”‚                                         â”‚
â”‚  [ğŸ‘ Lihat]  [â¬‡ Unduh]                â”‚
â”‚                                         â”‚
â”‚  ğŸ“œ Riwayat Revisi (jika ada)          â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ âŒ Perlu   â”‚   â”‚ âœ… Tidak   â”‚    â”‚
â”‚  â”‚  Revisi    â”‚   â”‚  Perlu      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  Revisi     â”‚    â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Stage 2A: Needs Revision (Perlu Revisi)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ Dokumen Memerlukan Revisi           â”‚
â”‚                                         â”‚
â”‚  ğŸ“„ Laporan KP                         â”‚
â”‚  [ğŸ‘ Lihat]  [â¬‡ Unduh]                â”‚
â”‚                                         â”‚
â”‚  âœï¸ Pesan Revisi *                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Jelaskan detail bagian yang     â”‚  â”‚
â”‚  â”‚ perlu diperbaiki...              â”‚  â”‚
â”‚  â”‚                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚  [ğŸ“¤ Kirim Pesan Revisi]               â”‚
â”‚                                         â”‚
â”‚  ğŸ“œ Riwayat Revisi Sebelumnya          â”‚
â”‚  - Versi 1: "Format penulisan..."     â”‚
â”‚  - Versi 2: "Daftar pustaka..."       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Stage 2B: No Revision (Tidak Perlu Revisi)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Dokumen Disetujui                   â”‚
â”‚                                         â”‚
â”‚  ğŸ“„ Laporan KP [âœ… Disetujui]          â”‚
â”‚  [ğŸ‘ Lihat]  [â¬‡ Unduh]                â”‚
â”‚                                         â”‚
â”‚  [Ubah Keputusan]                      â”‚
â”‚                                         â”‚
â”‚  â†’ Tab Penilaian otomatis terbuka      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’» Code Changes

### 1. RevisionReviewSection Component

#### Props Interface (Simplified)
```typescript
interface RevisionReviewSectionProps {
  studentId: string;
  onAllRevisionsApproved: (approved: boolean) => void;
  // Removed: noRevisionNeeded, onNoRevisionChange
}
```

#### New State
```typescript
type RevisionDecision = "undecided" | "needs-revision" | "no-revision";

interface LaporanRevision {
  fileName: string;
  fileSize: string;
  submittedAt: string;
  version: number;
  revisionMessage?: string;
  revisionHistory: Array<{
    version: number;
    message: string;
    submittedAt: string;
    status: "pending" | "revised";
  }>;
}

const [decision, setDecision] = useState<RevisionDecision>("undecided");
const [revisionMessage, setRevisionMessage] = useState("");
const [laporan, setLaporan] = useState<LaporanRevision>({...});
```

#### New Handlers
```typescript
const handleDecideNeedsRevision = () => {
  setDecision("needs-revision");
};

const handleDecideNoRevision = () => {
  if (confirm("Apakah Anda yakin dokumen sudah sempurna?")) {
    setDecision("no-revision");
  }
};

const handleSendRevisionMessage = async () => {
  if (!revisionMessage.trim()) {
    alert("Mohon tulis pesan revisi");
    return;
  }
  
  // Add to history
  setLaporan(prev => ({
    ...prev,
    revisionHistory: [...prev.revisionHistory, {
      version: prev.version,
      message: revisionMessage,
      submittedAt: new Date().toISOString(),
      status: "pending",
    }]
  }));
  
  alert("Pesan revisi berhasil dikirim");
  setRevisionMessage("");
};

const handleResetDecision = () => {
  setDecision("undecided");
  setRevisionMessage("");
};
```

### 2. GiveGradePage Updates

#### Removed State
```typescript
// âŒ Removed
const [noRevisionNeeded, setNoRevisionNeeded] = useState(false);
const handleNoRevisionChange = (noRevision: boolean) => {...};
```

#### Simplified Alert
```typescript
// Before: 2 different alerts
{allRevisionsApproved && !noRevisionNeeded && <Alert>...}
{noRevisionNeeded && <Alert>...}

// After: 1 unified alert
{allRevisionsApproved && (
  <Alert>Dokumen disetujui. Anda dapat memberikan penilaian.</Alert>
)}
```

## ğŸ¨ UI Components

### Decision Buttons (Stage 1)
```tsx
<div className="grid grid-cols-2 gap-4">
  {/* Perlu Revisi Button */}
  <Button
    onClick={handleDecideNeedsRevision}
    className="border-2 hover:border-orange-500"
  >
    <XCircle className="text-orange-600" />
    <span>Perlu Revisi</span>
    <span className="text-xs">Dokumen perlu diperbaiki</span>
  </Button>

  {/* Tidak Perlu Revisi Button */}
  <Button
    onClick={handleDecideNoRevision}
    className="border-2 hover:border-green-500"
  >
    <CheckCircle className="text-green-600" />
    <span>Tidak Perlu Revisi</span>
    <span className="text-xs">Dokumen sudah sempurna</span>
  </Button>
</div>
```

### Revision Message Form (Stage 2A)
```tsx
<div className="space-y-3">
  <Label>
    Pesan Revisi <span className="text-red-500">*</span>
  </Label>
  <Textarea
    value={revisionMessage}
    onChange={(e) => setRevisionMessage(e.target.value)}
    placeholder="Jelaskan secara detail bagian mana yang perlu diperbaiki..."
    className="min-h-[150px]"
  />
  <Button onClick={handleSendRevisionMessage}>
    <Send className="h-4 w-4" />
    Kirim Pesan Revisi
  </Button>
</div>
```

### Revision History Display
```tsx
<Card className="bg-gray-50">
  <CardHeader>
    <h4>Riwayat Revisi</h4>
  </CardHeader>
  <CardContent>
    {laporan.revisionHistory.map((history, index) => (
      <div key={index} className="bg-white rounded-lg p-3">
        <Badge>Versi {history.version}</Badge>
        <span>{formatDate(history.submittedAt)}</span>
        <p>{history.message}</p>
      </div>
    ))}
  </CardContent>
</Card>
```

## ğŸ“Š Data Structure

### Before (Multiple Documents)
```typescript
interface Revision {
  id: string;
  type: "Laporan KP" | "Slide Presentasi";
  fileName: string;
  status: "pending" | "approved" | "rejected";
  rejectReason?: string;
}

const revisions: Revision[] = [
  { id: "rev-1", type: "Laporan KP", ... },
  { id: "rev-2", type: "Slide Presentasi", ... }
];
```

### After (Single Document with History)
```typescript
interface LaporanRevision {
  fileName: string;
  fileSize: string;
  submittedAt: string;
  version: number;
  revisionMessage?: string;
  revisionHistory: Array<{
    version: number;
    message: string;
    submittedAt: string;
    status: "pending" | "revised";
  }>;
}

const laporan: LaporanRevision = {
  fileName: "Laporan_KP_RizkiMaulana_Final.pdf",
  version: 3,
  revisionHistory: [
    { version: 1, message: "Format penulisan...", status: "revised" },
    { version: 2, message: "Daftar pustaka...", status: "revised" }
  ]
};
```

## ğŸ”Œ API Integration

### Required Endpoints

```typescript
// Get laporan revision info
GET /api/students/:id/laporan-revision
Response: LaporanRevision

// Decide: No revision needed
POST /api/students/:id/revision/approve
Response: { success: boolean }

// Decide: Needs revision (send message)
POST /api/students/:id/revision/request
Body: { message: string }
Response: { success: boolean }

// Student uploads revised document (mahasiswa side)
POST /api/students/:id/laporan/upload
Body: FormData (file)
Response: { version: number, uploadedAt: string }
```

### Implementation Example

```typescript
// Send revision request
const handleSendRevisionMessage = async () => {
  try {
    const response = await fetch(`/api/students/${studentId}/revision/request`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: revisionMessage })
    });
    
    if (response.ok) {
      const data = await response.json();
      setLaporan(prev => ({
        ...prev,
        revisionHistory: [...prev.revisionHistory, data.revision]
      }));
      toast.success('Pesan revisi berhasil dikirim ke mahasiswa');
      setRevisionMessage("");
    }
  } catch (error) {
    toast.error('Gagal mengirim pesan revisi');
  }
};

// Approve without revision
const handleDecideNoRevision = async () => {
  if (!confirm("Yakin dokumen sudah sempurna?")) return;
  
  try {
    const response = await fetch(`/api/students/${studentId}/revision/approve`, {
      method: 'POST'
    });
    
    if (response.ok) {
      setDecision("no-revision");
      toast.success('Dokumen disetujui');
    }
  } catch (error) {
    toast.error('Gagal menyetujui dokumen');
  }
};
```

## âœ… Benefits

### For Dosen
- âœ… **Clearer decision making**: Pilih di awal, tidak bingung
- âœ… **Single focus**: Hanya review 1 dokumen (Laporan KP)
- âœ… **Direct communication**: Kirim pesan revisi langsung
- âœ… **View history**: Lihat semua revisi sebelumnya
- âœ… **Less clicks**: Workflow lebih cepat

### For Mahasiswa
- âœ… **Clear feedback**: Tahu persis apa yang harus diperbaiki
- âœ… **History tracking**: Bisa lihat progress revisi
- âœ… **Focused**: Hanya fokus perbaiki Laporan KP
- âœ… **Transparent**: Status jelas di setiap tahap

### For System
- âœ… **Simpler logic**: Tidak perlu handle multiple documents
- âœ… **Better UX**: Less complex, more intuitive
- âœ… **Easier to maintain**: Single document flow
- âœ… **Scalable**: Easy to extend with new features

## ğŸ¯ User Journey

### Scenario 1: Document Perfect (No Revision)
```
1. Dosen opens grading page
2. Sees laporan info + decision buttons
3. Clicks "Tidak Perlu Revisi" âœ…
4. Confirms decision
5. Tab Penilaian auto-opens
6. Fills grading form
7. Submits grade âœ…
```

### Scenario 2: Document Needs Revision
```
1. Dosen opens grading page
2. Sees laporan info + decision buttons
3. Can view/download PDF first
4. Clicks "Perlu Revisi" âŒ
5. Writes detailed revision message
6. Clicks "Kirim Pesan Revisi"
7. Message sent to student
--- Student revises and re-uploads ---
8. Dosen reviews again
9. If OK â†’ Clicks "Tidak Perlu Revisi" âœ…
10. Tab Penilaian opens
11. Submits grade âœ…
```

## ğŸ“ Testing Checklist

- [x] Stage 1: Undecided shows decision buttons
- [x] Stage 2A: Needs revision shows message form
- [x] Stage 2B: No revision unlocks grading tab
- [x] Can view/download PDF at any stage
- [x] Revision history displays correctly
- [x] "Ubah Keputusan" button resets to undecided
- [x] Validation for empty revision message
- [x] Parent callback triggered correctly
- [x] Tab auto-switches when no revision

## ğŸ”„ Migration Notes

If upgrading from v1.0:

1. **Database**: Update schema to single document model
2. **API**: Implement new endpoints
3. **Frontend**: Components already updated
4. **Data Migration**: Convert multi-doc revisions to single doc with history

## ğŸ“š Related Files

- [revision-review-section.tsx](c:\laragon\www\SIKP\app\feature\dosen-grading\components\revision-review-section.tsx) - Main component â­ UPDATED
- [give-grade-page.tsx](c:\laragon\www\SIKP\app\feature\dosen-grading\pages\give-grade-page.tsx) - Parent page â­ UPDATED
- [README.md](c:\laragon\www\SIKP\app\feature\dosen-grading\README.md) - Main documentation

---

**Last Updated**: January 17, 2026
**Version**: 2.0 - Simplified Single Document Workflow
